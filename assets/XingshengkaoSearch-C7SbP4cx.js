import{_ as b,f as u,g as j,o as p,R as B,a as I,S as y,i as o,D as g,U as m,t as f,C as R,V as U,F as $,B as _,m as C,h as k,e as w,r as h}from"./index-D0qlklnm.js";const v=(t,s)=>!s||new RegExp(s).test(t||"");function E(t,s,l){if(!v(t.字頭,s.字頭)||!v(t.聲首,s.聲首)||!v(t.諧聲域,s.諧聲域)||!v(t.上古聲,s.上古聲)||!v(t.上古韻,s.上古韻)||!v(t["上古音（參考）"],s["上古音（參考）"])||!v(t.中古地位,s.中古地位)||!v(t.切語,s.切語)||!v(t.切拼,s.切拼))return;let e={};if(s.釋義){const a=new RegExp(s.釋義);if(e=Object.fromEntries(Object.entries(t.釋義||{}).filter(([i])=>a.test(i))),Object.keys(e).length===0)return}else e={...t.釋義||{}};const r={聲首:t.聲首||"",諧聲域:t.諧聲域||"",上古聲:t.上古聲||"",上古韻:t.上古韻||"","上古音（參考）":t["上古音（參考）"]||"",中古地位:t.中古地位||"",切語:t.切語||"",切拼:t.切拼||"",釋義:e},d=JSON.stringify([r.聲首,r.諧聲域,r.上古聲,r.上古韻,r["上古音（參考）"],r.中古地位,r.切語,r.切拼]);l.has(t.字頭)||l.set(t.字頭,new Map);const n=l.get(t.字頭);n.has(d)?Object.assign(n.get(d).釋義,r.釋義):n.set(d,r)}function x(t){if(t.size===0)return[];const s=[],l=[...t.keys()].sort((e,r)=>e.localeCompare(r,"zh-Hant"));for(const e of l){const d=[...t.get(e).values()];d.sort((a,i)=>{const c=(a.切拼||"")+(a.中古地位||""),S=(i.切拼||"")+(i.中古地位||"");return c.localeCompare(S,"zh-Hant")});const n={};d.forEach(a=>{Object.assign(n,a.釋義)}),s.push({字頭:e,entries:d,allShiYi:n})}return s}async function O(t,s){if(!Object.values(t).some(i=>i.trim()!==""))throw new Error("请至少填写一个检索条件！");const e={};Object.keys(t).forEach(i=>{t[i].trim()!==""&&(e[i]=t[i].trim())});const r=["./xingshengkao_part1.json","./xingshengkao_part2.json","./xingshengkao_part3.json","./xingshengkao_part4.json","./xingshengkao_part5.json"],d=new Map;let n=0;const a=r.map(async i=>{const c=await fetch(i);if(!c.ok)throw new Error(`无法加载：${i}`);const S=await c.json();for(const V of S)E(V,e,d);n++,s&&s(n/r.length*100)});return await Promise.all(a),x(d)}const D={performSearch:O},L={name:"Instructions",props:{visible:{type:Boolean,default:!1}}},N={key:0,class:"instructions-content"};function F(t,s,l,e,r,d){return l.visible?(p(),u("div",N,s[0]||(s[0]=[B('<div class="content-card" data-v-f4f8626a><h2 data-v-f4f8626a>使用说明</h2><h3 data-v-f4f8626a>检索字段说明</h3><ul data-v-f4f8626a><li data-v-f4f8626a><strong data-v-f4f8626a>字頭：</strong>要查询的汉字</li><li data-v-f4f8626a><strong data-v-f4f8626a>諧聲域：</strong>声符的谐声范围</li><li data-v-f4f8626a><strong data-v-f4f8626a>聲首：</strong>声母信息</li><li data-v-f4f8626a><strong data-v-f4f8626a>上古聲：</strong>上古音声母</li><li data-v-f4f8626a><strong data-v-f4f8626a>上古韻：</strong>上古音韵母</li><li data-v-f4f8626a><strong data-v-f4f8626a>上古音（參考）：</strong>上古音参考读音</li><li data-v-f4f8626a><strong data-v-f4f8626a>中古地位：</strong>中古音地位信息</li><li data-v-f4f8626a><strong data-v-f4f8626a>切語：</strong>反切用字</li><li data-v-f4f8626a><strong data-v-f4f8626a>切拼：</strong>切韵拼音</li><li data-v-f4f8626a><strong data-v-f4f8626a>釋義：</strong>字义解释</li></ul><p data-v-f4f8626a><strong data-v-f4f8626a>注意：</strong>所有字段均支持正则表达式匹配，留空表示不限制该字段。</p></div>',1)]))):j("",!0)}const P=b(L,[["render",F],["__scopeId","data-v-f4f8626a"]]),z={name:"SearchForm",props:{isLoading:{type:Boolean,default:!1}},emits:["search"],setup(t,{emit:s}){const l=I({form:{字頭:"",諧聲域:"",聲首:"",上古聲:"",上古韻:"","上古音（參考）":"",中古地位:"",切語:"",切拼:"",釋義:""}}),e=()=>{s("search",{...l.form})};return{...y(l),onSubmit:e}}},M={class:"form-group"},H={class:"form-group"},Y={class:"form-group"},T={class:"form-group"},X={class:"form-group"},A={class:"form-group"},J={class:"form-group"},K={class:"form-group"},G={class:"form-group"},Q={class:"form-group full-width"},W={class:"form-group full-width"},Z=["disabled"];function q(t,s,l,e,r,d){return p(),u("form",{class:"search-form",onSubmit:s[10]||(s[10]=R((...n)=>e.onSubmit&&e.onSubmit(...n),["prevent"]))},[o("div",M,[s[11]||(s[11]=o("label",{for:"字頭"},"字頭",-1)),g(o("input",{type:"text",id:"字頭","onUpdate:modelValue":s[0]||(s[0]=n=>t.form.字頭=n),placeholder:"如：水"},null,512),[[m,t.form.字頭]])]),o("div",H,[s[12]||(s[12]=o("label",{for:"諧聲域"},"諧聲域",-1)),g(o("input",{type:"text",id:"諧聲域","onUpdate:modelValue":s[1]||(s[1]=n=>t.form.諧聲域=n),placeholder:"如：水部"},null,512),[[m,t.form.諧聲域]])]),o("div",Y,[s[13]||(s[13]=o("label",{for:"聲首"},"聲首",-1)),g(o("input",{type:"text",id:"聲首","onUpdate:modelValue":s[2]||(s[2]=n=>t.form.聲首=n),placeholder:"如：s"},null,512),[[m,t.form.聲首]])]),o("div",T,[s[14]||(s[14]=o("label",{for:"上古聲"},"上古聲",-1)),g(o("input",{type:"text",id:"上古聲","onUpdate:modelValue":s[3]||(s[3]=n=>t.form.上古聲=n),placeholder:"如：*s-"},null,512),[[m,t.form.上古聲]])]),o("div",X,[s[15]||(s[15]=o("label",{for:"上古韻"},"上古韻",-1)),g(o("input",{type:"text",id:"上古韻","onUpdate:modelValue":s[4]||(s[4]=n=>t.form.上古韻=n),placeholder:"如：*-uj"},null,512),[[m,t.form.上古韻]])]),o("div",A,[s[16]||(s[16]=o("label",{for:"上古音（參考）"},"上古音（參考）",-1)),g(o("input",{type:"text",id:"上古音（參考）","onUpdate:modelValue":s[5]||(s[5]=n=>t.form["上古音（參考）"]=n),placeholder:"如：*suj"},null,512),[[m,t.form["上古音（參考）"]]])]),o("div",J,[s[17]||(s[17]=o("label",{for:"中古地位"},"中古地位",-1)),g(o("input",{type:"text",id:"中古地位","onUpdate:modelValue":s[6]||(s[6]=n=>t.form.中古地位=n),placeholder:"如：心母"},null,512),[[m,t.form.中古地位]])]),o("div",K,[s[18]||(s[18]=o("label",{for:"切語"},"切語",-1)),g(o("input",{type:"text",id:"切語","onUpdate:modelValue":s[7]||(s[7]=n=>t.form.切語=n),placeholder:"如：式聚切"},null,512),[[m,t.form.切語]])]),o("div",G,[s[19]||(s[19]=o("label",{for:"切拼"},"切拼",-1)),g(o("input",{type:"text",id:"切拼","onUpdate:modelValue":s[8]||(s[8]=n=>t.form.切拼=n),placeholder:"如：syuiH"},null,512),[[m,t.form.切拼]])]),o("div",Q,[s[20]||(s[20]=o("label",{for:"釋義"},"釋義",-1)),g(o("input",{type:"text",id:"釋義","onUpdate:modelValue":s[9]||(s[9]=n=>t.form.釋義=n),placeholder:"如：水也"},null,512),[[m,t.form.釋義]])]),o("div",W,[o("button",{type:"submit",disabled:l.isLoading},f(l.isLoading?"检索中...":"开始检索"),9,Z)])],32)}const ss=b(z,[["render",q],["__scopeId","data-v-fa33c7ef"]]),os={name:"ProgressBar",props:{visible:{type:Boolean,default:!1},progress:{type:Number,default:0}}},ts={key:0,id:"progressContainer"},ns={id:"progressBar"};function es(t,s,l,e,r,d){return l.visible?(p(),u("div",ts,[o("div",ns,[o("div",{id:"progressFill",style:U({width:l.progress+"%"})},null,4)]),o("p",null,"正在加载数据... "+f(l.progress.toFixed(0))+"%",1)])):j("",!0)}const ls=b(os,[["render",es],["__scopeId","data-v-321f360e"]]),as={name:"ResultsDisplay",props:{results:{type:Array,default:()=>[]},hasSearched:{type:Boolean,default:!1}}},rs={key:0,id:"resultsContainer"},is={key:0,class:"error"},ds={key:1},fs={class:"card-title"},us={class:"readings-wrapper"},ps={class:"reading-head"},gs={class:"card-shiyi"},ms={class:"shiyi-key"},vs={class:"shiyi-val"};function cs(t,s,l,e,r,d){return l.results.length>0||l.hasSearched&&l.results.length===0?(p(),u("div",rs,[l.results.length===0?(p(),u("div",is," 没有找到符合条件的条目。 ")):(p(),u("div",ds,[(p(!0),u($,null,_(l.results,n=>(p(),u("div",{key:n.字頭,class:"char-card"},[o("div",fs,f(n.字頭),1),o("div",us,[(p(!0),u($,null,_(n.entries,(a,i)=>(p(),u("div",{key:i,class:"reading-block"},[o("h4",ps,"读音 #"+f(i+1),1),o("p",null,[s[0]||(s[0]=o("strong",null,"聲首：",-1)),o("span",null,f(a.聲首||"—"),1)]),o("p",null,[s[1]||(s[1]=o("strong",null,"諧聲域：",-1)),o("span",null,f(a.諧聲域||"—"),1)]),o("p",null,[s[2]||(s[2]=o("strong",null,"上古聲：",-1)),o("span",null,f(a.上古聲||"—"),1)]),o("p",null,[s[3]||(s[3]=o("strong",null,"上古韻：",-1)),o("span",null,f(a.上古韻||"—"),1)]),o("p",null,[s[4]||(s[4]=o("strong",null,"上古音（參考）：",-1)),o("span",null,f(a["上古音（參考）"]||"—"),1)]),o("p",null,[s[5]||(s[5]=o("strong",null,"中古地位：",-1)),o("span",null,f(a.中古地位||"—"),1)]),o("p",null,[s[6]||(s[6]=o("strong",null,"切語：",-1)),o("span",null,f(a.切語||"—"),1)]),o("p",null,[s[7]||(s[7]=o("strong",null,"切拼：",-1)),o("span",null,f(a.切拼||"—"),1)])]))),128))]),o("div",gs,[s[9]||(s[9]=o("p",null,[o("strong",null,"釋義：")],-1)),o("ul",null,[(p(!0),u($,null,_(n.allShiYi,(a,i)=>(p(),u("li",{key:i},[o("span",ms,"「"+f(i)+"」",1),s[8]||(s[8]=C(" → ")),o("span",vs,f(a),1)]))),128))])])]))),128))]))])):j("",!0)}const hs=b(as,[["render",cs],["__scopeId","data-v-8e2c6033"]]),bs={name:"XingshengkaoSearch",components:{Instructions:P,SearchForm:ss,ProgressBar:ls,ResultsDisplay:hs},setup(){const t=h(!1),s=h(!1),l=h(0),e=h(!1),r=h([]);return{showInstructions:t,isLoading:s,progress:l,hasSearched:e,searchResults:r,handleSearch:async n=>{try{s.value=!0,l.value=0,r.value=[],e.value=!0;const a=await D.performSearch(n,i=>{l.value=i});r.value=a}catch(a){console.error("搜索出错：",a),alert(a.message||"搜索过程中出现错误，请稍后重试。")}finally{s.value=!1}}}}},Ss={class:"xingshengkao-container"},ks={class:"xingshengkao-header"};function ws(t,s,l,e,r,d){const n=w("Instructions"),a=w("SearchForm"),i=w("ProgressBar"),c=w("ResultsDisplay");return p(),u("div",Ss,[o("div",ks,[s[1]||(s[1]=o("h1",null,"形声考组合检索",-1)),o("button",{class:"info-button",onClick:s[0]||(s[0]=S=>e.showInstructions=!e.showInstructions)},f(e.showInstructions?"隐藏使用说明":"查看使用说明"),1)]),k(n,{visible:e.showInstructions},null,8,["visible"]),k(a,{"is-loading":e.isLoading,onSearch:e.handleSearch},null,8,["is-loading","onSearch"]),k(i,{visible:e.isLoading,progress:e.progress},null,8,["visible","progress"]),k(c,{results:e.searchResults,"has-searched":e.hasSearched},null,8,["results","has-searched"])])}const _s=b(bs,[["render",ws]]);export{_s as default};
