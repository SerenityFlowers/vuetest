import{r as S,a as Y,b as M,d as H,_ as L,e as d,f as $,g as K,o as g,h as e,w as l,i as r,u as _,l as W,k as se,t as F,m as D,n as ne,q as Z,v as re,x as E,y as J,z as Q,A as X,F as j,B,c as P,C as q,D as G,E as ee,G as ce,H as te,I as le,T as ie,J as de,K as ue,L as he,M as _e,N as ge,O as pe,P as me,Q as fe}from"./index-DCWhh45B.js";function ve(){const n=S(!1),s=S(!1),a=S(null),p=S(null),u=Y({results:[],sources:[],totalFound:0,patterns:[]}),t=M(()=>p.value?.fields||[]),k=M(()=>p.value?.sources||{}),f=M(()=>p.value?.searchableFields||[]);return{loaded:n,loading:s,error:a,currentDictionary:p,searchResults:u,fields:t,sources:k,searchableFields:f,loadDictionary:async c=>{s.value=!0,a.value=null;try{const o=await H.loadDictionary(c);p.value=o,n.value=!0}catch(o){a.value=o.message,console.error("字典加载失败:",o)}finally{s.value=!1}},search:c=>{if(!n.value){a.value="字典未加载";return}try{const o=H.search(c);Object.assign(u,o),a.value=null}catch(o){a.value=o.message,u.results=[],u.sources=[],u.totalFound=0}},getAllDictionaries:()=>H.getAllDictionaries(),reset:()=>{n.value=!1,s.value=!1,a.value=null,p.value=null,Object.assign(u,{results:[],sources:[],totalFound:0,patterns:[]})}}}const ye={key:0,class:"loading-container"},be={key:0,class:"loading-content"},we={key:1,class:"error-content"},ke={class:"error-text"},xe={key:2,class:"loading-content"},$e={__name:"LoadingMessage",props:{loaded:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["retry"],setup(n){return(s,a)=>{const p=d("el-icon"),u=d("el-button"),t=d("el-card");return!n.loaded||n.loading||n.error?(g(),$("div",ye,[e(t,{class:"loading-card",shadow:"hover"},{default:l(()=>[n.loading?(g(),$("div",be,[e(p,{class:"loading-icon",size:48},{default:l(()=>[e(_(W))]),_:1}),a[1]||(a[1]=r("p",{class:"loading-text"},"正在加载字典数据...",-1))])):n.error?(g(),$("div",we,[e(p,{class:"error-icon",size:48,color:"#f56c6c"},{default:l(()=>[e(_(se))]),_:1}),r("p",ke,F(n.error),1),e(u,{type:"primary",onClick:a[0]||(a[0]=k=>s.$emit("retry")),class:"retry-button"},{default:l(()=>[e(p,null,{default:l(()=>[e(_(ne))]),_:1}),a[2]||(a[2]=D(" 重试 "))]),_:1,__:[2]})])):(g(),$("div",xe,[e(p,{class:"loading-icon",size:48},{default:l(()=>[e(_(W))]),_:1}),a[3]||(a[3]=r("p",{class:"loading-text"},"准备中...",-1))]))]),_:1})])):K("",!0)}}},Ce=L($e,[["__scopeId","data-v-8cf0e810"]]),Se={class:"search-container"},Ve={__name:"SearchForm",props:{fields:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["search","show-variants"],setup(n,{expose:s,emit:a}){const p=n,u=a,t=Y({keyword:"",variantToggle:"withVariants",searchField:""}),k=S(null),f=v=>{v.key==="Enter"&&(v.target.tagName==="INPUT"||v.target.tagName==="TEXTAREA"||v.target.contentEditable==="true"||t.keyword.trim()&&!p.disabled&&T())};Z(()=>{document.addEventListener("keydown",f)}),re(()=>{document.removeEventListener("keydown",f)}),E(()=>p.fields,v=>{v?.length>0&&(!t.searchField||!v.includes(t.searchField))&&(t.searchField=v[0])},{immediate:!0});function T(){t.keyword.trim()&&(p.disabled||A())}function z(){t.keyword="",J(()=>{k.value?.focus()})}function A(){u("search",{keyword:t.keyword.trim(),variantToggle:t.variantToggle,searchField:t.searchField})}return s({focus:()=>{J(()=>{k.value?.focus()})},clear:z}),(v,c)=>{const o=d("el-input"),b=d("el-col"),i=d("el-option"),h=d("el-select"),w=d("el-button"),y=d("el-row"),x=d("el-form");return g(),$("div",Se,[e(x,{model:t,onSubmit:q(T,["prevent"]),inline:!0,size:"large"},{default:l(()=>[e(y,{gutter:16,justify:"start",align:"middle"},{default:l(()=>[e(b,{span:14},{default:l(()=>[e(o,{modelValue:t.keyword,"onUpdate:modelValue":c[0]||(c[0]=m=>t.keyword=m),placeholder:"輸入一個繁體字",clearable:"","prefix-icon":_(X),onKeyup:[Q(T,["enter"]),Q(z,["esc"])],ref_key:"keywordInput",ref:k,disabled:n.disabled,class:"search-input"},null,8,["modelValue","prefix-icon","disabled"])]),_:1}),e(b,{span:3},{default:l(()=>[e(h,{modelValue:t.variantToggle,"onUpdate:modelValue":c[1]||(c[1]=m=>t.variantToggle=m),placeholder:"異體字",disabled:n.disabled,class:"compact-select"},{default:l(()=>[e(i,{label:"查詢異體字",value:"withVariants"}),e(i,{label:"只查原字",value:"withoutVariants"})]),_:1},8,["modelValue","disabled"])]),_:1}),e(b,{span:3},{default:l(()=>[e(h,{modelValue:t.searchField,"onUpdate:modelValue":c[2]||(c[2]=m=>t.searchField=m),placeholder:"查詢字段",disabled:n.disabled,class:"compact-select"},{default:l(()=>[(g(!0),$(j,null,B(n.fields,m=>(g(),P(i,{key:m,label:`查「${m}」`,value:m},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),e(b,{span:2},{default:l(()=>[e(w,{type:"info",disabled:n.disabled||!t.keyword.trim(),onClick:c[3]||(c[3]=m=>v.$emit("show-variants")),class:"variant-button"},{default:l(()=>c[4]||(c[4]=[D(" 查看異體字組 ")])),_:1,__:[4]},8,["disabled"])]),_:1}),e(b,{span:2},{default:l(()=>[e(w,{type:"primary",disabled:n.disabled||!t.keyword.trim(),onClick:T,icon:_(X),loading:n.disabled,class:"search-button"},{default:l(()=>[D(F(n.disabled?"查詢中...":"查詢"),1)]),_:1},8,["disabled","icon","loading"])]),_:1})]),_:1})]),_:1},8,["model"])])}}},Fe=L(Ve,[["__scopeId","data-v-4f0c9527"]]),Te={class:"card-header"},De={class:"header-left"},Pe={class:"header-right"},ze={class:"filter-content"},Ae={key:0,class:"sources-section"},Me={class:"checkbox-content"},Ie={class:"source-name"},Ee={key:1,class:"empty-state"},Ke={__name:"SourceSelector",props:{sourceStats:{type:Object,default:()=>({})},modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(n,{emit:s}){const a=n,p=s,u=S([...a.modelValue]),t=S(!1),k=S(!1),f=M(()=>a.sourceStats?Object.entries(a.sourceStats).map(([o,b])=>({name:o,count:b})).sort((o,b)=>{if(o.count!==b.count)return b.count-o.count;const i=/^[\u4e00-\u9fa5]/.test(o.name),h=/^[\u4e00-\u9fa5]/.test(b.name);return i&&!h?-1:!i&&h?1:o.name.localeCompare(b.name)}):[]);function T(){t.value?u.value=f.value.map(c=>c.name):u.value=[],v()}function z(c){u.value=c,v()}function A(){k.value=!k.value}function v(){p("update:modelValue",u.value)}return E(()=>a.modelValue,c=>{u.value=[...c||[]]},{immediate:!0}),E(u,c=>{f.value.length>0?t.value=c.length===f.value.length:t.value=!1},{deep:!0,immediate:!0}),E(f,()=>{f.value.length>0?t.value=u.value.length===f.value.length:t.value=!1},{immediate:!0}),(c,o)=>{const b=d("el-icon"),i=d("el-checkbox"),h=d("el-button"),w=d("el-tag"),y=d("el-col"),x=d("el-row"),m=d("el-checkbox-group"),I=d("el-empty"),R=d("el-collapse-transition"),U=d("el-card");return g(),P(U,{shadow:"hover",class:"filter-card source-selector-card"},{header:l(()=>[r("div",Te,[r("div",De,[e(b,null,{default:l(()=>[e(_(ce))]),_:1}),o[2]||(o[2]=r("span",null,"選擇查詢來源",-1))]),r("div",Pe,[e(i,{modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=C=>t.value=C),onChange:T,class:"select-all-checkbox",disabled:f.value.length===0},{default:l(()=>o[3]||(o[3]=[r("span",{class:"select-all-text"},"全選/取消全選",-1)])),_:1,__:[3]},8,["modelValue","disabled"]),e(h,{type:"text",size:"small",onClick:A,class:"collapse-button",icon:k.value?_(te):_(le)},null,8,["icon"])])])]),default:l(()=>[e(R,null,{default:l(()=>[G(r("div",ze,[f.value.length>0?(g(),$("div",Ae,[e(m,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=C=>u.value=C),onChange:z,class:"checkbox-group"},{default:l(()=>[e(x,{gutter:16},{default:l(()=>[(g(!0),$(j,null,B(f.value,({name:C,count:O})=>(g(),P(y,{key:C,lg:8,md:12,sm:24,xs:24},{default:l(()=>[e(i,{label:C,class:"source-checkbox"},{default:l(()=>[r("div",Me,[r("span",Ie,F(C),1),e(w,{size:"small",type:"info"},{default:l(()=>[D(F(O)+" 條",1)]),_:2},1024)])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"])])):(g(),$("div",Ee,[e(I,{description:"暫無可選擇的來源","image-size":60})]))],512),[[ee,!k.value]])]),_:1})]),_:1})}}},Le=L(Ke,[["__scopeId","data-v-7adcd80c"]]),Re={class:"modal-content"},Ue={class:"variant-table-container"},je={class:"variant-table"},Be={class:"variant-origin"},Oe={class:"variant-group"},Ne={__name:"VariantPopup",props:{keyword:String,groups:Array},setup(n,{expose:s}){const a=S(!1),p=()=>{a.value=!1};return s({show:a}),(u,t)=>(g(),P(ie,{to:"body"},[a.value?(g(),$("div",{key:0,class:"modal",onClick:q(p,["self"])},[r("div",Re,[r("button",{class:"close-button",onClick:p,"aria-label":"關閉"},t[0]||(t[0]=[r("span",null,"×",-1)])),t[2]||(t[2]=r("h3",{class:"modal-title"},"異體字組",-1)),r("div",Ue,[r("table",je,[t[1]||(t[1]=r("thead",null,[r("tr",null,[r("th",null,"輸入字"),r("th",null,"異體字組")])],-1)),r("tbody",null,[(g(!0),$(j,null,B(n.groups,(k,f)=>(g(),$("tr",{key:f},[r("td",Be,F(n.keyword[f]),1),r("td",Oe,F([...new Set(k)].join(" / ")),1)]))),128))])])])])])):K("",!0)]))}},He=L(Ne,[["__scopeId","data-v-292bbf20"]]),qe={class:"card-header"},Ge={class:"header-left"},We={class:"header-right"},Je={class:"filter-content"},Qe={key:0,class:"sources-section"},Xe={class:"checkbox-content"},Ye={class:"source-name"},Ze={key:1,class:"empty-state"},et={__name:"FilterCheckboxes",props:{sources:{type:Array,default:()=>[]}},emits:["update:selected"],setup(n,{emit:s}){const a=n,p=s,u=S([]),t=S(!1),k=S(!1),f=M(()=>u.value);function T(){t.value?u.value=[...a.sources]:u.value=[],v()}function z(c){u.value=c,v()}function A(){k.value=!k.value}function v(){p("update:selected",u.value)}return E(()=>a.sources,c=>{if(c&&c.length>0){const o=u.value.filter(b=>c.includes(b));u.value=o}else u.value=[]},{immediate:!0}),E(u,c=>{a.sources.length>0?t.value=c.length===a.sources.length:t.value=!1},{deep:!0,immediate:!0}),E(()=>a.sources,()=>{a.sources.length>0?t.value=u.value.length===a.sources.length:t.value=!1},{immediate:!0}),(c,o)=>{const b=d("el-icon"),i=d("el-tag"),h=d("el-checkbox"),w=d("el-button"),y=d("el-col"),x=d("el-row"),m=d("el-checkbox-group"),I=d("el-empty"),R=d("el-collapse-transition"),U=d("el-card");return g(),P(U,{shadow:"hover",class:"filter-card filter-checkboxes-card"},{header:l(()=>[r("div",qe,[r("div",Ge,[e(b,null,{default:l(()=>[e(_(de))]),_:1}),o[2]||(o[2]=r("span",null,"篩選結果來源",-1)),n.sources.length>0?(g(),P(i,{key:0,size:"small",type:"info",effect:"light",class:"source-count"},{default:l(()=>[D(F(f.value.length)+"/"+F(n.sources.length),1)]),_:1})):K("",!0)]),r("div",We,[e(h,{modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=C=>t.value=C),onChange:T,disabled:n.sources.length===0,class:"select-all-checkbox"},{default:l(()=>o[3]||(o[3]=[r("span",{class:"select-all-text"},"全選/取消全選",-1)])),_:1,__:[3]},8,["modelValue","disabled"]),e(w,{type:"text",size:"small",onClick:A,class:"collapse-button",icon:k.value?_(te):_(le)},null,8,["icon"])])])]),default:l(()=>[e(R,null,{default:l(()=>[G(r("div",Je,[n.sources.length>0?(g(),$("div",Qe,[e(m,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=C=>u.value=C),onChange:z,class:"checkbox-group"},{default:l(()=>[e(x,{gutter:16},{default:l(()=>[(g(!0),$(j,null,B(n.sources,C=>(g(),P(y,{key:C,lg:8,md:12,sm:24,xs:24},{default:l(()=>[e(h,{label:C,class:"source-checkbox"},{default:l(()=>[r("div",Xe,[r("span",Ye,F(C),1)])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"])])):(g(),$("div",Ze,[e(I,{description:"暫無可篩選的來源","image-size":60})]))],512),[[ee,!k.value]])]),_:1})]),_:1})}}},tt=L(et,[["__scopeId","data-v-c3c83a24"]]),lt={class:"table-header"},at={class:"header-left"},ot={class:"header-right"},st=["innerHTML"],nt={__name:"ResultsTable",props:{fields:{type:Array,default:()=>[]},rows:{type:Array,default:()=>[]},displaySources:{type:Set,default:()=>new Set},loading:{type:Boolean,default:!1},highlightKeyword:{type:String,default:""},highlightPatterns:{type:Array,default:()=>[]}},setup(n){const s=n,a=S([...s.fields]),p=S("wrap"),u=M(()=>s.rows.filter(i=>s.displaySources.has(i.source||""))),t=M(()=>s.fields.filter(i=>a.value.includes(i))),k=M(()=>p.value==="truncate"?"隐藏溢出":"自动换行"),f=M(()=>s.loading?"加载中...":s.rows.length===0?"沒有找到相關資料":u.value.length===0?"当前筛选条件下没有数据":"沒有找到相關資料"),T=(i,h)=>{if(h)a.value.includes(i)||a.value.push(i);else{const w=a.value.indexOf(i);w>-1&&a.value.splice(w,1)}},z=i=>{},A=i=>{p.value=i},v=i=>{const h=Math.max(...s.rows.map(w=>w[i]?String(w[i]).length:0),i.length);return h<=4?60:h<=8?90:h<=16?120:h<=32?180:240},c=i=>Math.max(...s.rows.map(w=>w[i]?String(w[i]).length:0),i.length)<=4?60:void 0,o=(i,h)=>{const w=i[h]||"";if(!s.highlightKeyword&&(!s.highlightPatterns||s.highlightPatterns.length===0))return w;let y=w;if(s.highlightKeyword&&y.includes(s.highlightKeyword)){const x=s.highlightKeyword.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),m=new RegExp(`(${x})`,"gi");y=y.replace(m,'<span class="highlight-text">$1</span>')}if(s.highlightPatterns&&s.highlightPatterns.length>0){for(const x of s.highlightPatterns)if(y.includes(x)){const m=x.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),I=new RegExp(`(${m})`,"gi");y=y.replace(I,'<span class="highlight-text">$1</span>')}}return y},b=({row:i,rowIndex:h})=>(s.highlightKeyword||s.highlightPatterns&&s.highlightPatterns.length>0)&&t.value.some(y=>{const x=i[y]||"";if(s.highlightKeyword&&x.toLowerCase().includes(s.highlightKeyword.toLowerCase()))return!0;if(s.highlightPatterns&&s.highlightPatterns.length>0){for(const m of s.highlightPatterns)if(x.includes(m))return!0}return!1})?"highlight-row":"";return E(()=>s.fields,i=>{i.forEach(h=>{a.value.includes(h)||a.value.push(h)})},{deep:!0}),(i,h)=>{const w=d("el-tag"),y=d("el-button"),x=d("el-checkbox"),m=d("el-dropdown-item"),I=d("el-dropdown-menu"),R=d("el-dropdown"),U=d("el-icon"),C=d("el-table-column"),O=d("el-table"),ae=d("el-card"),oe=ue("loading");return g(),P(ae,{shadow:"hover",class:"enhanced-results-table-card"},{header:l(()=>[r("div",lt,[r("div",at,[h[1]||(h[1]=r("span",{class:"header-title"},"查询结果",-1)),e(w,{type:"info",size:"small"},{default:l(()=>[D("共 "+F(n.rows.length)+" 条记录",1)]),_:1})]),r("div",ot,[e(R,{onCommand:z,trigger:"click"},{dropdown:l(()=>[e(I,null,{default:l(()=>[(g(!0),$(j,null,B(n.fields,V=>(g(),P(m,{key:V,command:V,divided:V==="source"},{default:l(()=>[e(x,{"model-value":a.value.includes(V),onChange:N=>T(V,N),onClick:h[0]||(h[0]=q(()=>{},["stop"]))},{default:l(()=>[D(F(V),1)]),_:2},1032,["model-value","onChange"])]),_:2},1032,["command","divided"]))),128))]),_:1})]),default:l(()=>[e(y,{size:"small",icon:_(_e)},{default:l(()=>h[2]||(h[2]=[D(" 列设置 ")])),_:1,__:[2]},8,["icon"])]),_:1}),e(R,{onCommand:A,trigger:"click"},{dropdown:l(()=>[e(I,null,{default:l(()=>[e(m,{command:"truncate"},{default:l(()=>[e(U,null,{default:l(()=>[e(_(pe))]),_:1}),h[3]||(h[3]=D(" 隐藏溢出 "))]),_:1,__:[3]}),e(m,{command:"wrap"},{default:l(()=>[e(U,null,{default:l(()=>[e(_(me))]),_:1}),h[4]||(h[4]=D(" 自动换行 "))]),_:1,__:[4]})]),_:1})]),default:l(()=>[e(y,{size:"small",icon:_(ge)},{default:l(()=>[D(F(k.value),1)]),_:1},8,["icon"])]),_:1})])])]),default:l(()=>[G((g(),P(O,{data:u.value,stripe:"",border:"",size:"default","empty-text":f.value,"header-cell-class-name":"table-header-cell",style:{width:"100%"},"row-class-name":b},{default:l(()=>[e(C,{prop:"index",label:"序号",width:"80",align:"center"},{default:l(({$index:V})=>[e(w,{size:"small",type:"info"},{default:l(()=>[D(F(V+1),1)]),_:2},1024)]),_:1}),(g(!0),$(j,null,B(t.value,V=>(g(),P(C,{key:V,prop:V,label:V,"min-width":v(V),width:c(V),"show-overflow-tooltip":p.value==="truncate"},{default:l(({row:N})=>[r("div",{class:he(p.value==="wrap"?"cell-simple-wrap":"cell-content"),innerHTML:o(N,V)},null,10,st)]),_:2},1032,["prop","label","min-width","width","show-overflow-tooltip"]))),128))]),_:1},8,["data","empty-text"])),[[oe,n.loading]])]),_:1})}}},rt=L(nt,[["__scopeId","data-v-0154becf"]]),ct={class:"dictionary-page"},it={class:"page-container"},dt={class:"page-header"},ut={class:"page-title"},ht={class:"page-subtitle"},_t={key:0,class:"section"},gt={key:2,class:"section"},pt={key:3,class:"section"},mt={__name:"DictionaryTemplate",props:{dictionaryId:{type:String,required:!0},dictionaryConfig:{type:Object,required:!0}},setup(n){const s=n,{loaded:a,loading:p,error:u,searchResults:t,fields:k,sources:f,searchableFields:T,loadDictionary:z,search:A}=ve(),v=S([]),c=S(new Set),o=S(""),b=S(null);Z(async()=>{await i()});const i=async()=>{try{await z(s.dictionaryId),f.value&&Object.keys(f.value).length>0?v.value=Object.keys(f.value):v.value=[],c.value=new Set,o.value="",Object.assign(t,{results:[],sources:[],totalFound:0,patterns:[]})}catch(y){console.error(`${s.dictionaryConfig.name}字典加载失败:`,y)}},h=({keyword:y,variantToggle:x,searchField:m})=>{if(o.value=y,!y){fe.warning("請輸入要查詢的內容！");return}A({keyword:y,searchField:m,selectedSources:v.value,variantToggle:x}),t.sources.length&&(c.value=new Set(t.sources))},w=()=>{b.value&&(b.value.show=!0)};return(y,x)=>(g(),$("div",ct,[r("div",it,[r("header",dt,[r("h1",ut,F(n.dictionaryConfig.name),1),r("p",ht,F(n.dictionaryConfig.description),1)]),e(Ce,{loaded:_(a),loading:_(p),error:_(u),onRetry:i},null,8,["loaded","loading","error"]),_(a)?(g(),$("section",_t,[e(Fe,{fields:_(T),disabled:_(p),onSearch:h,onShowVariants:w},null,8,["fields","disabled"])])):K("",!0),o.value&&_(t).groups&&_(t).groups.length?(g(),P(He,{key:1,keyword:o.value,groups:_(t).groups,ref_key:"variantPopupRef",ref:b},null,8,["keyword","groups"])):K("",!0),_(a)?(g(),$("section",gt,[e(Le,{"source-stats":_(f),modelValue:v.value,"onUpdate:modelValue":x[0]||(x[0]=m=>v.value=m)},null,8,["source-stats","modelValue"])])):K("",!0),_(t).results.length?(g(),$("section",pt,[e(tt,{sources:_(t).sources,"onUpdate:selected":x[1]||(x[1]=m=>c.value=new Set(m))},null,8,["sources"]),e(rt,{fields:_(k),rows:_(t).results,displaySources:c.value,loading:_(p),"highlight-keyword":o.value,"highlight-patterns":_(t).patterns},null,8,["fields","rows","displaySources","loading","highlight-keyword","highlight-patterns"])])):K("",!0)])]))}},vt=L(mt,[["__scopeId","data-v-582949c9"]]);export{vt as D};
